# --- Ù…Ø±Ø­Ù„Ù‡ Û±: Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø¯Ø±Ø§ÛŒÙˆ Ùˆ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Hugging Face ---
from google.colab import drive
from google.colab import userdata
from huggingface_hub import login
import os

# Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ú¯ÙˆÚ¯Ù„ Ø¯Ø±Ø§ÛŒÙˆ
drive.mount('/content/drive')

# Ø®ÙˆØ§Ù†Ø¯Ù† ØªÙˆÚ©Ù† Ø§Ø² Ù‚Ø³Ù…Øª Secrets Ùˆ ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨
try:
    hf_token = userdata.get('HF_TOKEN')
    login(token=hf_token)
    print("âœ… Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Hugging Face ÙˆØ§Ø±Ø¯ Ø´Ø¯ÛŒØ¯.")
except Exception as e:
    print("âŒ Ø®Ø·Ø§ÛŒÛŒ Ø¯Ø± ÙˆØ±ÙˆØ¯ Ø¨Ù‡ Ø­Ø³Ø§Ø¨ Ø±Ø® Ø¯Ø§Ø¯. Ù…Ø·Ù…Ø¦Ù† Ø´ÙˆÛŒØ¯ ØªÙˆÚ©Ù† Ø±Ø§ Ø¯Ø± Ù‚Ø³Ù…Øª Secrets Ø°Ø®ÛŒØ±Ù‡ Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯.")
    print(e)


# --- Ù…Ø±Ø­Ù„Ù‡ Û²: ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ØµÙ„ÛŒ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ---
base_dir = "/content/drive/MyDrive/AI_Offline_Repo_FULL"
archive_name = "AI_Offline_Repo_FULL.tar.gz"
archive_path = f"/content/drive/MyDrive/{archive_name}"

python_libraries = list(set([
    "torch", "torchvision", "torchaudio", "tensorflow", "transformers", "accelerate", "bitsandbytes",
    "datasets", "peft", "Pillow", "sentence-transformers", "tqdm", "langchain", "langchain-community",
    "langchain-text-splitters", "chromadb", "PyMuPDF", "pdf2image", "PyYAML", "streamlit",
    "streamlit-mermaid", "gradio", "huggingface_hub", "jupyter", "faiss-cpu"
]))

models_to_download = {
    "gemma-2b-it": "TheBloke/gemma-2b-it-GGUF/gemma-2b-it.Q4_K_M.gguf",
    "gemma-7b-it": "TheBloke/gemma-7b-it-GGUF/gemma-7b-it.Q5_K_M.gguf",
    "llama-3-8b-instruct": "TheBloke/Meta-Llama-3-8B-Instruct-GGUF/meta-llama-3-8b-instruct.Q4_K_M.gguf",
    "llama-3-70b-instruct": "TheBloke/Meta-Llama-3-70B-Instruct-GGUF/meta-llama-3-70b-instruct.Q4_K_M.gguf",
    "deepseek-coder-v2-lite": "TheBloke/deepseek-coder-v2-lite-instruct-GGUF/deepseek-coder-v2-lite-instruct.Q4_K_M.gguf",
    "deepseek-llm-7b-chat": "TheBloke/deepseek-llm-7b-chat-GGUF/deepseek-llm-7b-chat.Q5_K_M.gguf",
    "qwen-1.5-4b-chat": "TheBloke/Qwen1.5-4B-Chat-GGUF/qwen1_5-4b-chat.Q5_K_M.gguf",
    "qwen-1.5-14b-chat": "TheBloke/Qwen1.5-14B-Chat-GGUF/qwen1_5-14b-chat.Q5_K_M.gguf"
}

# --- Ù…Ø±Ø§Ø­Ù„ Û³ Ùˆ Û´ (Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±) ---
pypi_dir = os.path.join(base_dir, "PyPI_Libraries")
models_dir = os.path.join(base_dir, "AI_Models")
github_dir = os.path.join(base_dir, "GitHub_Tools")

os.makedirs(pypi_dir, exist_ok=True)
os.makedirs(models_dir, exist_ok=True)
os.makedirs(github_dir, exist_ok=True)
print(f"Ø³Ø§Ø®ØªØ§Ø± Ù¾ÙˆØ´Ù‡ Ø¯Ø± Ù…Ø³ÛŒØ± {base_dir} Ø§ÛŒØ¬Ø§Ø¯ Ø´Ø¯.")

# Û±. Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ PyPI
print("\nâ³ Ø´Ø±ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ PyPI...")
requirements_path = "/content/requirements.txt"
with open(requirements_path, "w") as f:
    f.write("\n".join(python_libraries))
!pip download -r {requirements_path} -d {pypi_dir}
print("âœ… Ø¯Ø§Ù†Ù„ÙˆØ¯ Ú©ØªØ§Ø¨Ø®Ø§Ù†Ù‡â€ŒÙ‡Ø§ÛŒ PyPI ØªÙ…Ø§Ù… Ø´Ø¯.")

# Û². Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ
print("\nâ³ Ø´Ø±ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ...")
# !pip install -q huggingface_hub # Ø¯ÛŒÚ¯Ø± Ù„Ø§Ø²Ù… Ù†ÛŒØ³Øª Ú†ÙˆÙ† Ø¯Ø± Ø§Ø¨ØªØ¯Ø§ import Ú©Ø±Ø¯ÛŒÙ…
for name, path in models_to_download.items():
    try:
        parts = path.split('/')
        repo_id = f"{parts[0]}/{parts[1]}"
        filename = parts[2]
        print(f"--- Ø¯Ø± Ø­Ø§Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¯Ù„: {name} ---")
        !huggingface-cli download {repo_id} {filename} --local-dir {models_dir}/{name} --local-dir-use-symlinks False
    except Exception as e:
        print(f"à¹€à¸à¸´à¸”à¸‚à¹‰à¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”à¹ƒà¸™à¸à¸²à¸£à¸”à¸²à¸§à¸™à¹Œà¹‚à¸«à¸¥à¸”à¹‚à¸¡à¹€à¸”à¸¥ {name}: {e}") # Ù¾ÛŒØ§Ù… Ø®Ø·Ø§ Ø¯Ø± ØµÙˆØ±Øª Ø¨Ø±ÙˆØ² Ù…Ø´Ú©Ù„
print("âœ… Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…Ø¯Ù„â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ ØªÙ…Ø§Ù… Ø´Ø¯.")

# Û³. Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨
print("\nâ³ Ø´Ø±ÙˆØ¹ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ (llama.cpp Ùˆ text-generation-webui)...")
!git clone https://github.com/ggerganov/llama.cpp.git {github_dir}/llama.cpp
!git clone https://github.com/oobabooga/text-generation-webui.git {github_dir}/text-generation-webui
print("âœ… Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø¨Ø²Ø§Ø±Ù‡Ø§ÛŒ Ú¯ÛŒØªâ€ŒÙ‡Ø§Ø¨ ØªÙ…Ø§Ù… Ø´Ø¯.")

# --- Ù…Ø±Ø­Ù„Ù‡ Û´: ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù‡Ù…Ù‡ Ú†ÛŒØ² Ø¯Ø± ÛŒÚ© ÙØ§ÛŒÙ„ ---
print(f"\nâ³ Ø´Ø±ÙˆØ¹ ÙØ´Ø±Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ú©Ù„ Ù¾ÙˆØ´Ù‡ Ø¯Ø± ÙØ§ÛŒÙ„ {archive_name}...")
!tar -czf {archive_path} -C {os.path.dirname(base_dir)} {os.path.basename(base_dir)}

print("\nğŸ‰ğŸ‰ğŸ‰ Ø¹Ù…Ù„ÛŒØ§Øª Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÙ…Ø§Ù… Ø´Ø¯! ğŸ‰ğŸ‰ğŸ‰")
print(f"ÙØ§ÛŒÙ„ ÙØ´Ø±Ø¯Ù‡ Ú©Ø§Ù…Ù„ Ø¯Ø± Ù…Ø³ÛŒØ± Ø²ÛŒØ± Ø¯Ø± Ú¯ÙˆÚ¯Ù„ Ø¯Ø±Ø§ÛŒÙˆ Ø´Ù…Ø§ Ø°Ø®ÛŒØ±Ù‡ Ø´Ø¯:\n{archive_path}")
